%tests the factorization generated by matrix-factor
mat_name = '1138_bus';
base = '/ubc/cs/home/i/inutard/Dropbox/Online Resources/My Homework/UBC 2011W/NSERC/matrix-factor-recode';
file = strcat(base, mat_name, '.mtx');
A = mmread(file);
l = mmread(strcat(base, 'output_matrices/outL.mtx'));
d = mmread(strcat(base, 'output_matrices/outD.mtx'));
%p = mmread('C:\Users\Paul\Documents\My Dropbox\Online Resources\My Homework\UBC 2011W\NSERC\matrix-factor\output_matrices\outPerm.mtx');
%p = diag(p)+1;
p = 1:size(A,1);

display(norm(A(p,p) - l*d*l', 1));
spy(A(p,p)); figure; spy(abs(l*d*l') > 0.001);

e = ones(size(A,1),1);
gmres(A(p,p),e,5,1e-6,50,l*d+0.001*speye(size(A,1)), l');